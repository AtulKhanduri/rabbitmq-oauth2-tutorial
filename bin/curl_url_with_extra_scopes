#!/usr/bin/env bash

SCRIPT="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

CONTEXT=${1:?First parameter must be the uaac context name. Run uaac contexts to find out which contexts are available}
URL=${2:?Second parameter must be the url to curl}

token=$(uaac context $CONTEXT | awk '/access_token/ { print $2}')
token=$($SCRIPT/copy_scopes.py $SCRIPT/../conf/private.pem $SCRIPT/../conf/public.pem rabbitmq extra-scope $token)
echo "token => $token"

curl -u :$token $URL
